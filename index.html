<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>New Year Courier – Side View</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: system-ui, sans-serif;
  }
  body {
    background: #0a0a14;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  #game-container {
    position: relative;
    width: 900px;
    height: 600px;
    border: 2px solid #333;
    border-radius: 10px;
    overflow: hidden;
    background: linear-gradient(#1a1a2e, #0a0a14);
  }
  canvas {
    width: 100%;
    height: 100%;
    display: block;
  }

  /* HUD */
  #hud {
    position: absolute;
    top: 10px;
    left: 10px;
    right: 10px;
    display: flex;
    justify-content: space-between;
    pointer-events: none;
    color: white;
    font-size: 16px;
  }

  /* Wish button */
  #wish-button {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 24px;
    background: #ffd54f;
    border: none;
    border-radius: 999px;
    font-weight: bold;
    cursor: pointer;
    display: none;
  }

  /* Riddle modal */
  #riddle-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    justify-content: center;
    align-items: center;
  }
  #riddle-box {
    background: #111827;
    padding: 20px;
    border-radius: 10px;
    width: 350px;
    color: white;
  }
  #riddle-answer {
    width: 100%;
    padding: 8px;
    margin-top: 10px;
    border-radius: 6px;
    border: 1px solid #333;
    background: #000;
    color: white;
  }
  #riddle-buttons {
    margin-top: 15px;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
  }
  .btn {
    padding: 8px 14px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
  }
  .btn-primary {
    background: #22c55e;
    color: black;
  }
  .btn-secondary {
    background: #555;
    color: white;
  }

  /* End screen */
  #end-screen {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.85);
    color: white;
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    text-align: center;
  }
  #restart {
    margin-top: 20px;
    padding: 12px 20px;
    background: #3b82f6;
    border: none;
    border-radius: 8px;
    color: white;
    cursor: pointer;
  }
</style>
</head>
<body>
<div id="game-container">
  <canvas id="game"></canvas>

  <div id="hud">
    <div id="clock">Time: 11:00</div>
    <div id="stats">NPCs wished: 0 / 12</div>
  </div>

  <button id="wish-button">Wish?</button>

  <div id="riddle-backdrop">
    <div id="riddle-box">
      <div id="riddle-question"></div>
      <input id="riddle-answer" placeholder="Your answer..." />
      <div id="riddle-result"></div>
      <div id="riddle-buttons">
        <button class="btn btn-secondary" id="cancel-riddle">Cancel</button>
        <button class="btn btn-primary" id="submit-riddle">Submit</button>
      </div>
    </div>
  </div>

  <div id="end-screen">
    <h1 id="end-title"></h1>
    <p id="end-message"></p>
    <button id="restart">Play Again</button>
  </div>
</div>

<script>
/* CANVAS SETUP */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 900;
canvas.height = 600;

/* GAME CONSTANTS */
const PLAYER_WIDTH = 40;
const PLAYER_HEIGHT = 70;
const NPC_WIDTH = 40;
const NPC_HEIGHT = 70;
const SPEED = 200;
const NPC_COUNT = 12;
const INTERACT_RANGE = 60;
const START_TIME = 120; // 2 minutes

/* UI ELEMENTS */
const clockEl = document.getElementById("clock");
const statsEl = document.getElementById("stats");
const wishBtn = document.getElementById("wish-button");
const riddleBackdrop = document.getElementById("riddle-backdrop");
const riddleQuestion = document.getElementById("riddle-question");
const riddleAnswer = document.getElementById("riddle-answer");
const riddleResult = document.getElementById("riddle-result");
const submitRiddle = document.getElementById("submit-riddle");
const cancelRiddle = document.getElementById("cancel-riddle");
const endScreen = document.getElementById("end-screen");
const endTitle = document.getElementById("end-title");
const endMessage = document.getElementById("end-message");
const restartBtn = document.getElementById("restart");

/* RIDDLES */
const RIDDLES = [
  { q: "I come at the end of the year and the start of another.", a: "new year" },
  { q: "I shine at night and count down to twelve.", a: "clock" },
  { q: "I am the first month after New Year’s Eve.", a: "january" },
  { q: "People make me on New Year to change something.", a: "resolution" },
  { q: "I fill the sky with colors and sound at midnight.", a: "fireworks" },
  { q: "You raise me in your hand to celebrate.", a: "glass" },
  { q: "I fall from the sky as tiny white flakes.", a: "snow" },
  { q: "I am a greeting people say when a year begins.", a: "happy new year" },
  { q: "I show the days and months of a year.", a: "calendar" },
  { q: "I ring loudly when the clock strikes twelve.", a: "bell" },
  { q: "I am the night before the new year.", a: "new year eve" },
  { q: "You blow me at parties and I make a loud sound.", a: "party horn" }
];

/* GAME STATE */
let player = { x: 100, y: 450 };
let npcs = [];
let keys = {};
let timeLeft = START_TIME;
let lastTime = null;
let gameRunning = true;
let interactingNPC = null;

/* CREATE NPCs */
function spawnNPCs() {
  npcs = [];
  for (let i = 0; i < NPC_COUNT; i++) {
    npcs.push({
      x: 150 + i * 60,
      y: 450,
      wished: false,
      riddle: RIDDLES[i]
    });
  }
}

/* DRAW FUNCTIONS */
function drawGround() {
  ctx.fillStyle = "#2d2d44";
  ctx.fillRect(0, 520, canvas.width, 80);
}

function drawGrandfatherClock() {
  ctx.fillStyle = "#5a3e1b";
  ctx.fillRect(20, 300, 80, 220);

  ctx.fillStyle = "#d4c08a";
  ctx.beginPath();
  ctx.arc(60, 330, 30, 0, Math.PI * 2);
  ctx.fill();

  let minutes = Math.floor(timeLeft);
  let angle = (minutes / START_TIME) * Math.PI * 2;

  ctx.strokeStyle = "black";
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(60, 330);
  ctx.lineTo(60 + Math.cos(angle) * 20, 330 + Math.sin(angle) * 20);
  ctx.stroke();
}

function drawPlayer() {
  ctx.fillStyle = "#ffcc66";
  ctx.fillRect(player.x, player.y - PLAYER_HEIGHT, PLAYER_WIDTH, PLAYER_HEIGHT);
}

function drawNPCs() {
  npcs.forEach(npc => {
    ctx.fillStyle = npc.wished ? "#22c55e" : "#3b82f6";
    ctx.fillRect(npc.x, npc.y - NPC_HEIGHT, NPC_WIDTH, NPC_HEIGHT);
  });
}

/* UPDATE */
function update(dt) {
  if (!gameRunning) return;

  timeLeft -= dt;
  if (timeLeft <= 0) {
    timeLeft = 0;
    endGame(false);
  }

  let vx = 0;
  if (keys["ArrowLeft"]) vx = -1;
  if (keys["ArrowRight"]) vx = 1;

  player.x += vx * SPEED * dt;
  player.x = Math.max(0, Math.min(canvas.width - PLAYER_WIDTH, player.x));

  let nearNPC = npcs.find(n => !n.wished && Math.abs(n.x - player.x) < INTERACT_RANGE);
  wishBtn.style.display = nearNPC ? "block" : "none";

  updateHUD();
}

/* HUD */
function updateHUD() {
  clockEl.textContent = "Time: 11:" + String(Math.floor(timeLeft)).padStart(2, "0");
  statsEl.textContent = `NPCs wished: ${npcs.filter(n => n.wished).length} / ${NPC_COUNT}`;
}

/* GAME LOOP */
function loop(timestamp) {
  if (!lastTime) lastTime = timestamp;
  let dt = (timestamp - lastTime) / 1000;
  lastTime = timestamp;

  update(dt);
  draw();

  if (gameRunning) requestAnimationFrame(loop);
}

/* DRAW EVERYTHING */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawGround();
  drawGrandfatherClock();
  drawNPCs();
  drawPlayer();
}

/* RIDDLE LOGIC */
wishBtn.onclick = () => {
  let npc = npcs.find(n => !n.wished && Math.abs(n.x - player.x) < INTERACT_RANGE);
  if (!npc) return;

  interactingNPC = npc;
  riddleQuestion.textContent = npc.riddle.q;
  riddleAnswer.value = "";
  riddleResult.textContent = "";
  riddleBackdrop.style.display = "flex";
};

submitRiddle.onclick = () => {
  let ans = riddleAnswer.value.trim().toLowerCase();
  let correct = interactingNPC.riddle.a.toLowerCase();

  if (ans.replace(/\s+/g, "") === correct.replace(/\s+/g, "")) {
    interactingNPC.wished = true;
    riddleBackdrop.style.display = "none";

    if (npcs.every(n => n.wished)) {
      endGame(true);
    }
  } else {
    riddleResult.textContent = "You're wrong, try again.";
  }
};

cancelRiddle.onclick = () => {
  riddleBackdrop.style.display = "none";
};

/* END GAME */
function endGame(win) {
  gameRunning = false;
  endScreen.style.display = "flex";

  if (win) {
    endTitle.textContent = "Happy New Year!!!!!";
    endMessage.textContent = "You wished everyone before midnight!";
  } else {
    endTitle.textContent = "Too Late!";
    endMessage.textContent = "Midnight arrived before you finished.";
  }
}

/* INPUT */
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

/* RESTART */
restartBtn.onclick = () => {
  timeLeft = START_TIME;
  player.x = 100;
  spawnNPCs();
  gameRunning = true;
  endScreen.style.display = "none";
  lastTime = null;
  requestAnimationFrame(loop);
};

/* START GAME */
spawnNPCs();
requestAnimationFrame(loop);
</script>
</body>
</html>
